\section{Monotonicidade, convexidade e matrizes Monge}
\label{MatrizMonge}

%----------------------------------------------------------------------------------------

Aqui serão apresentados e explorados os conceitos de monotonicidade, convexidade e matrizes Monge, além disso, alguns resultados referentes a estes conceitos serão demonstrados. Estes conceitos são fundamentais para o desenvolvimento do restante do trabalho.

\begin{defi}[Vetor monótono]
Seja $a \in \B{Q}^n$ um vetor, $a$ é dito monótono quando vale uma das propriedades abaixo.
    \begin{itemize}
        \item Se para todo $i,j \in [n]$, $i < j \so a_i \leq a_j$, $a$ é dito monótono crescente (ou só crescente).
        \item Se para todo $i,j \in [n]$, $i < j \so a_i \geq a_j$, $a$ é dito monótono decrescente (ou só decrescente).
    \end{itemize}
\end{defi}

Sabemos que a monotonicidade de vetores pode ser aproveitada para agilizar alguns algoritmos importantes, por exemplo, a busca binária pode ser interpretada como uma otimização da busca linear para vetores monótonos. 

\begin{defi}[Vetor convexo]
Seja $a \in \B{Q}^n$ um vetor,
    \begin{itemize}
        \item se para todo $i,j,k \in [n]$, $i < j < k \so a_j \leq \frac{(j-k)a_i + (i-j)a_k}{i-k}$, $a$ é dito convexo e
        \item se para todo $i,j,k \in [n]$, $i < j < k \so a_j \geq \frac{(j-k)a_i + (i-j)a_k}{i-k}$, $a$ é dito côncavo.
    \end{itemize}
\end{defi}

Geralmente, ao se definir convexidade de funções, diz-se que a função é convexa se e somente se para todo par $x,y$ no domínio da função e todo $\lambda \in [0,1]$ real, $f(\lambda x + (1 - \lambda)y) \leq \lambda f(x) + (1 - \lambda) f(y)$. A definição utilizada aqui é compatível com essa, porém, é específica para vetores. Uma situação parecida ocorre no sentido da concavidade.

Assim como a monotonicidade, a convexidade também é usualmente explorada para agilizar algoritmos, por exemplo, se um vetor é estritamente convexo (a desigualdade apresentada na definição vale estritamente) podemos encontrar o mínimo (que é único) com uma busca ternária ao invés de percorrer todo o vetor.  

\begin{defi}
Seja $A \in \B{Q}^{n \times m}$, definimos quatro vetores a seguir.
    \begin{itemize}
        \item O vetor de índices de máximos das linhas de $A$ guarda na posição $i$ 
              o número $\min\{j \in [m] \mid A[i][j] \geq A[i][j'] \text{ para todo } j' \in [m]\}$. 
        \item O vetor de índices de mínimos das linhas de $A$ guarda na posição $i$ 
              o número $\min\{j \in [m] \mid A[i][j] \leq A[i][j'] \text{ para todo } j' \in [m]\}$. 
        \item O vetor de índices de máximos das colunas de $A$ guarda na posição $j$ 
              o número $\min\{i \in [n] \mid A[i][j] \geq A[i'][j] \text{ para todo } i' \in [n]\}$. 
        \item O vetor de índices de mínimos das colunas de $A$ guarda na posição $j$ 
              o número $\min\{i \in [n] \mid A[i][j] \leq A[i'][j] \text{ para todo } i' \in [n]\}$. 
    \end{itemize}

Note que o índice de máximo de uma linha é definido como o menor índice que contém o valor máximo daquela linha. O mesmo vale para colunas e mínimos.
\end{defi}

Dada uma matriz, encontrar estes vetores é um problema central para este trabalho. Para conseguir resolver este problema de maneira especialmente eficiente, podemos explorar as propriedades definidas a seguir.

\begin{defi}[Matriz monótona]
Seja $A \in \B{Q}^{n \times m}$ uma matriz. Se $A$ tiver o vetor de índices de máximos das linhas monótono, $A$ é dita monótona nos máximos das linhas. 

Valem também as definições análogas para mínimos ou colunas e pode-se especificar monotonicidade crescente ou decrescente.
\end{defi}

\begin{defi}[Matriz totalmente monótona]
Seja $A \in \B{Q}^{n \times m}$ uma matriz.
    \begin{itemize}
        \item Se $A[i][j'] > A[i][j]$ implica $A[i'][j'] > A[i'][j]$ para todo $1 \leq i < i' \leq n$ e $1 \leq j < j' \leq m$, $A$ é monótona convexa nas linhas.
        \item Se $A[i][j'] < A[i][j]$ implica $A[i'][j'] < A[i'][j]$ para todo $1 \leq i < i' \leq n$ e $1 \leq j < j' \leq m$, $A$ é monótona côncava nas linhas.
        \item Se $A[i'][j] > A[i][j]$ implica $A[i'][j'] > A[i][j']$ para todo $1 \leq i < i' \leq n$ e $1 \leq j < j' \leq m$, $A$ é monótona convexa nas colunas.
        \item Se $A[i'][j] < A[i][j]$ implica $A[i'][j'] < A[i][j']$ para todo $1 \leq i < i' \leq n$ e $1 \leq j < j' \leq m$, $A$ é monótona côncava nas colunas.
    \end{itemize}
\end{defi}

O motivo do uso dos termos ``convexa'' e ``côncava'' em relação a matrizes, tanto nesta definição quanto na Definição~\ref{defi:MatrizMonge} são justificados pelo Teorema~\ref{convexRelation}. Note que se uma matriz é totalmente monótona, todas as suas submatrizes são totalmente monótonas no mesmo sentido.

\begin{lema}
Se $A \in \B{Q}^{n \times m}$ é uma matriz totalmente monótona convexa nas linhas.
    \begin{enumerate}
        \item Toda submatriz de $A$ é monótona crescente nos máximos das linhas.
        \item Toda submatriz de $A$ é monótona decrescente nos mínimos das linhas.
    \end{enumerate}

Simetricamente, se $A$ é côncava nas linhas, suas submatrizes são decrescentes nos máximos e crescentes nos mínimos das linhas. O lema funciona análogamente em termos de colunas, também.  
\end{lema}

\begin{proof}
Seja $A \in \B{Q}^{n \times m}$ uma matriz totalmente monótona convexa nas linhas. Vamos provar que $A$ é monótona crescente nos máximos das linhas. Sejam $i < i'$ índices de linhas de $A$. Seja $j'$ o índice de máximo da linha $i$ e $j$ o índice de máximo da linha $i'$. Suponha, por absurdo, $j < j'$. Assim, teremos, já que $j'$ é o máximo na $i$-ésima linha, $A[i][j'] > A[i][j]$ e, por outro lado, já que $j$ é o máximo na $i'$-ésima, $A[i'][j] \geq A[i'][j']$, porém, $A$ é totalmente monótona, portanto, $A[i'][j'] > A[i'][j]$, uma contradição.  

Agora, vamos mostrar que $A$ é monótona decrescente nos mínimos das linhas. Sejam $i < i'$ índices de linhas de $A$. Seja $j$ o índice de mínimo da linha $i$ e $j'$ o índice de mínimo da linha $i'$. Suponha, por absurdo, $j < j'$. Assim, teremos $A[i][j] \leq A[i][j']$ e $A[i'][j'] < A[i'][j]$.

Finalmente, se $A'$ é uma submatriz de $A$, então $A'$ é totalmente monótona convexa nas linhas, portanto monótona crescente nos máximos das linhas e monótona decrescente nos mínimos das linhas.
\end{proof}

\begin{defi} \label{defi:MatrizMonge}
Seja $A \in \B{Q}^{n \times m}$.
    \begin{enumerate}
        \item Se vale $A[i][j] + A[i'][j'] \leq A[i][j'] + A[i'][j]$ para todo $1 \leq i < i' \leq n$ e $1 \leq j < j' \leq m$, $A$ é dita Monge convexa.
        \item Se vale $A[i][j] + A[i'][j'] \geq A[i][j'] + A[i'][j]$ para todo $1 \leq i < i' \leq n$ e $1 \leq j < j' \leq m$, $A$ é dita Monge côncava.
    \end{enumerate}
\end{defi}

A desigualdade que define as matrizes Monge é conhecida também por ``Condição de Monge'' ou ``Desigualdade Quadrangular''\todo{citação}.

\begin{theo}
Se $A$ é monge convexa, $A$ é totalmente monótona convexa tanto nas linhas quanto nas colunas.
\end{theo}

\begin{proof}
Só fazer.
\end{proof}

As matrizes Monge são usadas para resolver uma série de problemas que serão explorados aqui. Os algoritmos se baseam principalmente nas propriedades que não dependem da condição de Monge, mas ainda aparecem como consequência dela, a monotonicidade e a total monotonicidade, porém, em alguns casos é difícil demonstrar a validade destas propriedades sem recorrer aos resultados baseados em matrizes Monge que serão apresentados a seguir.  

Como consequência desta utilidade, iremos discutir um problema que será resolvido com um algoritmo apresentado somente na Seção~\ref{SMAWK}, o algoritmo SMAWK. Ele não será explicado neste momento, utilizamos ele como caixa preta. Isto é motivado pelo fato de que o pensamento apresentado aqui não é útil somente para o algoritmo SMAWK, ele é útil também em vários dos outros momentos deste trabalho.  

Considere dois inteiro $k \leq n$, um vetor de pesos $a \in \B{Q}^n$ e uma matriz de custos $A[i][j] = \left(\sum\limits_{k=i}^{j-1} a_k\right)^2$. Queremos particionar o vetor $a$ em $k$ partes não-vazias de forma a maximizar a soma dos custos das partes, isto é, queremos escolher um vetor $r \in \B{N}^{[0 \tdots k]}$ de índices tal que $1 = r_0 < r_1 < r_2 < \dots < r_{k-1} < r_k = n$ de forma que $\sum\limits_{i=1}^{k} A[r_{i-1}][r_i]$ seja máximo.

Podemos resolver este problema com programação dinâmica. Vamos preencher a matriz $E \in \B{Q}^{k \times n}$ definida recursivamente para todo $k' \in [k]$ e $n' \in [n]$: 
$$ E[k'][n'] = \begin{cases}
    A[1][n']                                               & \text{, se } k'= 1 \text{,} \\[2pt]
    \max\limits_{i=k'-1}^{n'-1} E[k'-1][i] + A[i][n']     & \text{, se } k' \leq n' \text{,} \\[2pt]
    \text{indefinida }                                    & \text{, caso contrário.}
\end{cases} $$

A recorrência acima nos dá em cada entrada o máximo valor possível alcançado particionando o vetor $a[1 \tdots n']$ em $k'$ partes não vazias. Podemos preencher esta tabela trivialmente em tempo $O(kn^2)$, basta iterarar primeiro pelos índices $k'$ crescentemente. O caso onde $k' = 1$ é resolvido trivialmente e os casos maiores podem ser resolvidos, um por vez, testando todas as possibilidades de máximo para todo $n'$.  

Fixamos um $k' > 1$. Vamos utilizar o algoritmo SMAWK para agilizar a solução deste subproblema. O algoritmo em questão pode ser usado para achar os máximos das colunas de uma matriz $n \times n$ totalmente monótona convexa nas colunas em tempo $O(2n)$, por isso, vamos reduzir o nosso problema com $k'$ fixo para o problema resolvível pelo SMAWK.  

Definimos a matriz $B_{k'}$ para todo $i',n' \in \B{N}$ onde $k'-1 \leq i' < n' \leq n$ como $B_{k'}[i'][n'] = E[k'-1][i] + A[i][n']$. Note que já que $k'$ é fixo, já descobrimos os valores da entrada da matriz $E$ na linha $k'-1$. Encontrar o índice $i$ que atinge o máximo em $E[k'][n']$ é exatamente encontrar o índice de máximo da coluna $n'$ na matriz $B_{k'}$. Por isso, queremos mostrar que $B_{k'}$ é totalmente monótona convexa em todo $k'$. Para isso, os dois resultados a seguir serão úteis. 

\begin{theo}
O de manter a convexidade.
\end{theo}

\begin{proof}
Só fazer.
\end{proof}

Com este resultado, é fácil ver que, desde que $A$ seja Monge convexa, $B_1$ será Monge convexa e a Monge convexidade será mantida para todo $B_{k'}$ com $k' \leq k$. O teorema a seguir nos ajuda a mostrar que $A$ é Monge convexa.

\begin{theo}
O do vetor convexo.
\end{theo}

\begin{proof}
Só fazer.
\end{proof}

Agora, vamos escrever formalmente a prova de que $B_{k'}$ é Monge convexa para todo $1 \leq k' \leq k$. Com isso, o algoritmo SMAWK pode ser aplicado para todo $k'$ e o problema original é resolvido em $O(kn)$.
